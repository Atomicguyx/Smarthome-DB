<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atomic Smart DB</title>
    <meta name="theme-color" content="hsl(222 47% 6%)">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-bolt"></i>
                    <h1>Atomic DB</h1>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#controls" class="nav-item" data-page="controls">
                    <i class="fas fa-sliders-h"></i>
                    <span>Controls</span>
                </a>
                <a href="#analytics" class="nav-item" data-page="analytics">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </a>
                <a href="#settings" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="device-info">
                    <i class="fas fa-microchip"></i>
                    <div>
                        <div class="device-name" id="deviceName">ESP32 Controller</div>
                        <div class="device-stats" id="deviceStats">16 Relays â€¢ 0 ON</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <h2 id="pageTitle">Smart Home Dashboard</h2>
                    <div class="breadcrumb" id="breadcrumb">Controls / All Relays</div>
                </div>
                <div class="header-right">
                    <div class="quick-actions">
                        <button class="btn-icon glow-accent" id="btnRefresh" title="Refresh">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="btn-icon glow-accent" id="btnSettingsModal" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="btn-icon glow-accent" id="btnFullscreen" title="Fullscreen">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                    <div class="time-display" id="timeDisplay">--:--:--</div>
                </div>
            </header>

            <!-- Dashboard Page (Default) -->
            <div id="dashboardPage" class="page active">
                <!-- Connection Status -->
                <div class="connection-card glass">
                    <div class="connection-info">
                        <div class="connection-icon">
                            <i class="fas fa-satellite-dish"></i>
                        </div>
                        <div class="connection-details">
                            <h3 id="mqttBroker">HiveMQ Cloud</h3>
                            <p id="connectionDetails">Establishing secure connection...</p>
                        </div>
                        <div class="connection-stats">
                            <div class="stat">
                                <span class="stat-label">Uptime</span>
                                <span class="stat-value" id="uptime">00:00:00</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Messages</span>
                                <span class="stat-value" id="messageCount">0</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Device ID</span>
                                <span class="stat-value" id="deviceId">---</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <section class="quick-actions-section">
                    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                    <div class="quick-grid">
                        <button class="quick-btn success" id="btnAllOn">
                            <i class="fas fa-play-circle"></i>
                            <span>Power All ON</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="quick-btn destructive" id="btnAllOff">
                            <i class="fas fa-stop-circle"></i>
                            <span>Power All OFF</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="quick-btn primary" id="btnGroupBedrooms">
                            <i class="fas fa-bed"></i>
                            <span>Bedrooms ON</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="quick-btn primary" id="btnGroupEssentials">
                            <i class="fas fa-fire"></i>
                            <span>Essentials ON</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="quick-btn warning" id="btnRange1_8">
                            <i class="fas fa-layer-group"></i>
                            <span>Relays 1-8 ON</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="quick-btn warning" id="btnRange9_16">
                            <i class="fas fa-layer-group"></i>
                            <span>Relays 9-16 ON</span>
                            <div class="btn-glow"></div>
                        </button>
                    </div>
                </section>

                <!-- Relays Grid -->
                <section class="relays-section">
                    <div class="section-header">
                        <h3><i class="fas fa-sliders-h"></i> Relay Controls</h3>
                        <div class="section-stats">
                            <div class="stat-badge success" id="statOn">0 ON</div>
                            <div class="stat-badge muted" id="statOff">16 OFF</div>
                            <div class="stat-badge primary" id="statTotal">16 Total</div>
                        </div>
                    </div>
                    
                    <div class="relays-grid" id="relaysGrid">
                        <!-- Generated by JavaScript -->
                    </div>
                </section>

                <!-- Activity Log -->
                <section class="log-section">
                    <div class="section-header">
                        <h3><i class="fas fa-terminal"></i> Activity Log</h3>
                        <button class="btn-icon" id="btnClearLog">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="log-container glass">
                        <div id="activityLog"></div>
                    </div>
                </section>
            </div>

            <!-- Controls Page -->
            <div id="controlsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-sliders-h"></i> Advanced Controls</h2>
                    <p>Fine-tuned control over all 16 relays with preset modes</p>
                </div>
                
                <!-- Quick Presets -->
                <section class="presets-section">
                    <div class="section-header">
                        <h3><i class="fas fa-save"></i> Quick Presets</h3>
                        <div class="section-actions">
                            <button class="btn-icon" id="btnCreatePreset" title="Save Current as Preset">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn-icon" id="btnRefreshPresets" title="Refresh Presets">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="presets-grid" id="presetsGrid">
                        <!-- Generated by JavaScript -->
                    </div>
                </section>
                
                <!-- Individual Relay Controls -->
                <section class="relays-section">
                    <div class="section-header">
                        <h3><i class="fas fa-microchip"></i> Individual Relay Control</h3>
                        <div class="section-stats">
                            <div class="stat-badge success" id="controlsStatOn">0 ON</div>
                            <div class="stat-badge muted" id="controlsStatOff">16 OFF</div>
                        </div>
                    </div>
                    
                    <div class="advanced-grid" id="advancedControlsGrid">
                        <!-- Generated by JavaScript -->
                    </div>
                </section>
                
                <!-- Schedule Section -->
                <section class="schedule-section">
                    <div class="section-header">
                        <h3><i class="fas fa-clock"></i> Schedule Presets</h3>
                        <button class="btn-primary" id="btnAddSchedule">
                            <i class="fas fa-plus"></i> Add Schedule
                        </button>
                    </div>
                    
                    <div class="schedule-list" id="scheduleList">
                        <!-- Schedules will be loaded here -->
                        <div class="no-schedules glass">
                            <i class="fas fa-clock fa-2x"></i>
                            <p>No schedules yet. Add your first schedule!</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Analytics Page -->
            <div id="analyticsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-chart-line"></i> System Analytics</h2>
                    <p>Usage statistics and performance metrics</p>
                </div>
                
                <div class="analytics-grid">
                    <div class="analytics-card glass">
                        <h3><i class="fas fa-bolt"></i> Device Status</h3>
                        <div class="status-list">
                            <div class="status-item">
                                <span class="label">Device ID</span>
                                <span class="value" id="analyticsDeviceId">---</span>
                            </div>
                            <div class="status-item">
                                <span class="label">MQTT Connection</span>
                                <span class="value status-good" id="analyticsMqttStatus">Disconnected</span>
                            </div>
                            <div class="status-item">
                                <span class="label">WiFi Signal</span>
                                <span class="value" id="analyticsWifiSignal">---</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Uptime</span>
                                <span class="value" id="analyticsUptime">00:00:00</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Memory Usage</span>
                                <span class="value" id="analyticsMemory">---</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Active Relays</span>
                                <span class="value" id="analyticsActiveRelays">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-card glass">
                        <h3><i class="fas fa-history"></i> Usage History</h3>
                        <div class="history-list" id="usageHistory">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="analytics-card glass">
                        <h3><i class="fas fa-chart-pie"></i> Relay Distribution</h3>
                        <div class="chart-container">
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <span class="legend-color" style="background: hsl(var(--success))"></span>
                                    <span class="legend-label">ON</span>
                                    <span class="legend-value" id="chartOnCount">0</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color" style="background: hsl(var(--muted-foreground))"></span>
                                    <span class="legend-label">OFF</span>
                                    <span class="legend-value" id="chartOffCount">16</span>
                                </div>
                            </div>
                            <div class="chart-placeholder" id="relayChart">
                                <!-- Chart will be drawn here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="page">
                <div class="page-header">
                    <h2><i class="fas fa-cog"></i> Settings</h2>
                    <p>Configure your system preferences</p>
                </div>
                
                <div class="settings-grid">
                    <div class="settings-card glass">
                        <h3><i class="fas fa-wifi"></i> Device Configuration</h3>
                        <div class="form-group">
                            <label for="deviceIdInput">Device ID</label>
                            <input type="text" id="deviceIdInput" placeholder="DB001" value="DB001">
                            <small class="form-hint">Must match ESP32 DEVICE_ID</small>
                        </div>
                        <div class="form-group">
                            <label for="mqttServer">MQTT Server URL</label>
                            <input type="text" id="mqttServer" value="xxxxxxxx.s1.eu.hivemq.cloud">
                        </div>
                        <div class="form-group">
                            <label for="mqttUsername">MQTT Username</label>
                            <input type="text" id="mqttUsername" value="your_username">
                        </div>
                        <div class="form-group">
                            <label for="mqttPassword">MQTT Password</label>
                            <input type="password" id="mqttPassword" value="your_password">
                        </div>
                        <div class="form-group">
                            <label for="mqttPort">MQTT Port</label>
                            <input type="number" id="mqttPort" value="8883" min="1" max="65535">
                        </div>
                        <div class="form-group">
                            <label for="baseTopic">Base Topic</label>
                            <input type="text" id="baseTopic" value="atomic">
                        </div>
                        <button class="btn-save" id="btnSaveMQTT">Save & Reconnect</button>
                    </div>
                    
                    <div class="settings-card glass">
                        <h3><i class="fas fa-network-wired"></i> WiFi Configuration</h3>
                        <div class="form-group">
                            <label for="wifiSsid">WiFi SSID</label>
                            <input type="text" id="wifiSsid" placeholder="Your WiFi Name">
                        </div>
                        <div class="form-group">
                            <label for="wifiPassword">WiFi Password</label>
                            <input type="password" id="wifiPassword" placeholder="Your WiFi Password">
                        </div>
                        <div class="form-group">
                            <label for="wifiConfigureToggle">
                                <input type="checkbox" id="wifiConfigureToggle">
                                Override ESP32 WiFi Configuration
                            </label>
                        </div>
                        <button class="btn-primary" id="btnSendWifiConfig">
                            <i class="fas fa-paper-plane"></i> Send to Device
                        </button>
                    </div>
                    
                    <div class="settings-card glass">
                        <h3><i class="fas fa-shield-alt"></i> Security & Device Management</h3>
                        <div class="form-group">
                            <label for="sessionTimeout">Session Timeout (minutes)</label>
                            <input type="number" id="sessionTimeout" value="30" min="5" max="240">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="requireAuth" checked>
                                Require MQTT Authentication
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableEncryption" checked>
                                Enable Payload Encryption
                            </label>
                        </div>
                        <div class="device-actions">
                            <button class="btn-warning" id="btnFactoryReset">
                                <i class="fas fa-redo"></i> Factory Reset Device
                            </button>
                            <button class="btn-danger" id="btnRebootDevice">
                                <i class="fas fa-power-off"></i> Reboot Device
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-card glass">
                        <h3><i class="fas fa-database"></i> Data & Backup</h3>
                        <div class="form-group">
                            <label for="logRetention">Log Retention (days)</label>
                            <input type="number" id="logRetention" value="30" min="1" max="365">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="autoBackup" checked>
                                Auto-backup configurations
                            </label>
                        </div>
                        <div class="data-actions">
                            <button class="btn-primary" id="btnExportConfig">
                                <i class="fas fa-download"></i> Export Configuration
                            </button>
                            <button class="btn-primary" id="btnImportConfig">
                                <i class="fas fa-upload"></i> Import Configuration
                            </button>
                            <button class="btn-warning" id="btnClearLocalData">
                                <i class="fas fa-trash"></i> Clear Local Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Settings Modal (Quick Access) -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-cog"></i> Quick Settings</h3>
                    <button class="btn-close" id="btnCloseModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <h4>Connection</h4>
                        <div class="form-group">
                            <label>MQTT Status</label>
                            <div class="status-badge" id="modalMqttStatus">Disconnected</div>
                        </div>
                        <button class="btn-small" id="btnReconnect">Reconnect</button>
                    </div>
                    
                    <div class="modal-section">
                        <h4>Quick Actions</h4>
                        <button class="btn-small success" id="modalAllOn">All ON</button>
                        <button class="btn-small destructive" id="modalAllOff">All OFF</button>
                        <button class="btn-small primary" id="modalRefresh">Refresh Status</button>
                        <button class="btn-small warning" id="modalRestore">Restore States</button>
                    </div>
                    
                    <div class="modal-section">
                        <h4>Go to Page</h4>
                        <div class="modal-links">
                            <a href="#dashboard" class="modal-link">Dashboard</a>
                            <a href="#controls" class="modal-link">Controls</a>
                            <a href="#analytics" class="modal-link">Analytics</a>
                            <a href="#settings" class="modal-link">Full Settings</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast"></div>
    </div>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-clock"></i> Add New Schedule</h3>
                <button class="btn-close" id="btnCloseScheduleModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="scheduleName">Schedule Name</label>
                    <input type="text" id="scheduleName" placeholder="e.g., Morning Routine" value="Morning Routine">
                </div>
                
                <div class="form-group">
                    <label for="scheduleTime">Time</label>
                    <input type="time" id="scheduleTime" value="06:00">
                </div>
                
                <div class="form-group">
                    <label for="schedulePreset">Preset</label>
                    <select id="schedulePreset">
                        <option value="home">Home Mode</option>
                        <option value="away">Away Mode</option>
                        <option value="night">Night Mode</option>
                        <option value="energy">Energy Save</option>
                        <option value="party">Party Mode</option>
                        <option value="morning">Morning Routine</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="scheduleRepeat">Repeat</label>
                    <select id="scheduleRepeat" multiple>
                        <option value="mon">Monday</option>
                        <option value="tue">Tuesday</option>
                        <option value="wed">Wednesday</option>
                        <option value="thu">Thursday</option>
                        <option value="fri">Friday</option>
                        <option value="sat">Saturday</option>
                        <option value="sun">Sunday</option>
                    </select>
                    <small class="form-hint">Hold Ctrl/Cmd to select multiple days</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="scheduleEnabled" checked>
                        Enable Schedule
                    </label>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-secondary" id="btnCancelSchedule">Cancel</button>
                    <button class="btn-primary" id="btnSaveSchedule">Save Schedule</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
